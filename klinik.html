<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking Antrean Klinik Kandungan - Proto</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles untuk highlight aktif */
        .calendar-day.active {
            @apply bg-blue-600 text-white;
        }
        .time-slot.active {
            @apply bg-blue-600 text-white;
        }
        /* Style untuk hari yang tidak bisa diklik */
        .calendar-day.disabled {
            @apply opacity-50 cursor-not-allowed pointer-events-none bg-gray-50;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen py-8 px-4">
    <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-2xl">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Booking Antrean Klinik Kandungan</h1>

        <div id="step-1" class="mb-8">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">1. Pilih Tanggal & Dokter</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="tanggal" class="block text-sm font-medium text-gray-700 mb-2">Tanggal Kunjungan</label>
                    <div id="calendar-container" class="border border-gray-300 rounded-md p-2">
                        <div class="flex justify-between items-center mb-2">
                            <button id="prevMonth" class="px-3 py-1 rounded-md bg-gray-200 hover:bg-gray-300">&lt;</button>
                            <span id="currentMonthYear" class="font-semibold text-lg"></span>
                            <button id="nextMonth" class="px-3 py-1 rounded-md bg-gray-200 hover:bg-gray-300">&gt;</button>
                        </div>
                        <div id="calendar-days-header" class="grid grid-cols-7 text-center text-xs font-semibold text-gray-500 mb-1">
                            <span>Min</span><span>Sen</span><span>Sel</span><span>Rab</span><span>Kam</span><span>Jum</span><span>Sab</span>
                        </div>
                        <div id="calendar-days" class="grid grid-cols-7 gap-1 text-center">
                            </div>
                    </div>
                    <input type="hidden" id="selectedDate" name="selectedDate">
                </div>

                <div>
                    <label for="doctor" class="block text-sm font-medium text-gray-700 mb-2">Pilih Dokter</label>
                    <select id="doctor" name="doctor" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                        <option value="">Pilih Dokter</option>
                        <option value="dr. Ayu, Sp.OG">dr. Ayu, Sp.OG</option>
                        <option value="dr. Budi, Sp.OG">dr. Budi, Sp.OG</option>
                    </select>
                </div>
            </div>
            <button id="nextToStep2" class="mt-6 w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">Lanjut ke Waktu</button>
        </div>

        <div id="step-2" class="hidden">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">2. Pilih Waktu & Data Kontak</h2>
            
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">Waktu Kunjungan</label>
                <div id="time-slots-container" class="grid grid-cols-3 md:grid-cols-4 gap-3">
                    </div>
                <input type="hidden" id="selectedTime" name="selectedTime">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                    <label for="patientName" class="block text-sm font-medium text-gray-700">Nama Lengkap</label>
                    <input type="text" id="patientName" name="patientName" required
                           class="mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2">
                </div>
                <div>
                    <label for="phoneNumber" class="block text-sm font-medium text-gray-700">Nomor Telepon</label>
                    <input type="tel" id="phoneNumber" name="phoneNumber" required
                           class="mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2">
                </div>
            </div>

            <div class="flex justify-between">
                <button id="prevToStep1" class="py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Kembali</button>
                <button id="confirmBooking" class="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">Konfirmasi Booking</button>
            </div>
        </div>

        <div id="step-3" class="hidden text-center">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">Booking Berhasil!</h2>
            <p class="text-lg text-gray-600 mb-4">Terima kasih, <span id="displayPatientName" class="font-bold"></span>.</p>
            <p class="text-lg text-gray-600 mb-2">Janji temu Anda telah dikonfirmasi untuk:</p>
            <p class="text-xl font-bold text-blue-600 mb-2"><span id="displayDate"></span> pukul <span id="displayTime"></span> WIB</p>
            <p class="text-lg text-gray-600 mb-4">Dengan <span id="displayDoctor" class="font-bold"></span>.</p>
            <p class="text-2xl font-bold text-green-700 mb-6">Nomor Antrean Anda: <span id="displayQueueNumber" class="text-4xl"></span></p>
            <p class="text-sm text-gray-500">Harap datang 15 menit sebelum jadwal. Anda akan melengkapi data pendaftaran saat tiba di klinik.</p>
            <button id="newBooking" class="mt-8 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">Booking Baru</button>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const step1 = document.getElementById('step-1');
            const step2 = document.getElementById('step-2');
            const step3 = document.getElementById('step-3');
            const nextToStep2Btn = document.getElementById('nextToStep2');
            const prevToStep1Btn = document.getElementById('prevToStep1');
            const confirmBookingBtn = document.getElementById('confirmBooking');
            const newBookingBtn = document.getElementById('newBooking');

            // Calendar Elements
            const calendarContainer = document.getElementById('calendar-days');
            const currentMonthYearSpan = document.getElementById('currentMonthYear');
            const prevMonthBtn = document.getElementById('prevMonth');
            const nextMonthBtn = document.getElementById('nextMonth');
            const selectedDateInput = document.getElementById('selectedDate');

            // Time Slot Elements
            const timeSlotsContainer = document.getElementById('time-slots-container');
            const selectedTimeInput = document.getElementById('selectedTime');

            // Input Fields
            const patientNameInput = document.getElementById('patientName');
            const phoneNumberInput = document.getElementById('phoneNumber');
            const doctorSelect = document.getElementById('doctor');

            // Display Elements (Step 3)
            const displayPatientName = document.getElementById('displayPatientName');
            const displayDate = document.getElementById('displayDate');
            const displayTime = document.getElementById('displayTime');
            const displayDoctor = document.getElementById('displayDoctor');
            const displayQueueNumber = document.getElementById('displayQueueNumber');

            // State Variables
            let currentMonth = new Date().getMonth();
            let currentYear = new Date().getFullYear();
            let selectedDate = null;
            let selectedTime = null;

            const availableTimeSlots = [ // Contoh slot waktu, bisa diambil dari backend nanti
                "09:00", "09:30", "10:00", "10:30", "11:00", "11:30",
                "13:00", "13:30", "14:00", "14:30", "15:00", "15:30"
            ];

            // --- Calendar Functions ---
            const renderCalendar = (month, year) => {
                calendarContainer.innerHTML = ''; // Clear previous days
                currentMonthYearSpan.textContent = new Date(year, month).toLocaleString('id-ID', { month: 'long', year: 'numeric' });

                const firstDayOfMonth = new Date(year, month, 1).getDay(); // 0 = Sunday, 1 = Monday, ...
                const daysInMonth = new Date(year, month + 1, 0).getDate(); // Last day of month

                // Add empty cells for preceding days
                for (let i = 0; i < firstDayOfMonth; i++) {
                    const emptyDiv = document.createElement('div');
                    calendarContainer.appendChild(emptyDiv);
                }

                // Add days of the month
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayDiv = document.createElement('div');
                    dayDiv.classList.add('calendar-day', 'p-2', 'cursor-pointer', 'rounded-md', 'hover:bg-blue-100', 'transition', 'duration-150');
                    dayDiv.textContent = day;
                    dayDiv.dataset.date = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`; // YYYY-MM-DD

                    // Highlight selected date if any
                    if (selectedDate === dayDiv.dataset.date) {
                        dayDiv.classList.add('active', 'bg-blue-600', 'text-white');
                    }

                    // Disable past dates and current day if time has passed
                    const today = new Date();
                    const currentDayDate = new Date(year, month, day);
                    currentDayDate.setHours(0,0,0,0); // Reset time for accurate date comparison

                    // Disable if it's a past date
                    if (currentDayDate < today.setHours(0,0,0,0)) { // Reset today's time for comparison
                        dayDiv.classList.add('disabled');
                    } else if (currentDayDate.getTime() === today.getTime()) { // If it's today
                        // Optional: you could disable today if all slots are full,
                        // but for this simple prototype, just allowing selection.
                        // Real-world scenario would check time-slots availability.
                    }

                    dayDiv.addEventListener('click', function() {
                        if (this.classList.contains('disabled')) return; // Prevent clicking disabled days

                        // Remove active class from previously selected day
                        document.querySelectorAll('.calendar-day').forEach(d => {
                            d.classList.remove('active', 'bg-blue-600', 'text-white');
                        });
                        // Add active class to current selected day
                        this.classList.add('active', 'bg-blue-600', 'text-white');
                        selectedDate = this.dataset.date;
                        selectedDateInput.value = selectedDate; // Update hidden input
                    });
                    calendarContainer.appendChild(dayDiv);
                }
            };

            const changeMonth = (offset) => {
                currentMonth += offset;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                } else if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                renderCalendar(currentMonth, currentYear);
            };

            prevMonthBtn.addEventListener('click', () => changeMonth(-1));
            nextMonthBtn.addEventListener('click', () => changeMonth(1));

            // Initial render
            renderCalendar(currentMonth, currentYear);

            // --- Time Slot Functions ---
            const renderTimeSlots = () => {
                timeSlotsContainer.innerHTML = '';
                availableTimeSlots.forEach(slot => {
                    const slotDiv = document.createElement('div');
                    slotDiv.classList.add('time-slot', 'p-3', 'border', 'border-gray-300', 'rounded-md', 'text-center', 'cursor-pointer', 'hover:bg-blue-100', 'transition', 'duration-150');
                    slotDiv.textContent = slot;
                    slotDiv.dataset.time = slot;

                    if (selectedTime === slot) {
                        slotDiv.classList.add('active', 'bg-blue-600', 'text-white');
                    }

                    // Optional: Disable past time slots if current date is today
                    const today = new Date();
                    const selectedDateObj = new Date(selectedDate);
                    // Set both to same date part, then compare time
                    if (selectedDateObj.toDateString() === today.toDateString()) {
                        const [hour, minute] = slot.split(':').map(Number);
                        const slotTime = new Date(today.getFullYear(), today.getMonth(), today.getDate(), hour, minute);
                        if (slotTime < today) {
                            slotDiv.classList.add('disabled');
                        }
                    }

                    slotDiv.addEventListener('click', function() {
                        if (this.classList.contains('disabled')) return;

                        document.querySelectorAll('.time-slot').forEach(s => {
                            s.classList.remove('active', 'bg-blue-600', 'text-white');
                        });
                        this.classList.add('active', 'bg-blue-600', 'text-white');
                        selectedTime = slot;
                        selectedTimeInput.value = selectedTime;
                    });
                    timeSlotsContainer.appendChild(slotDiv);
                });
            };

            // --- Navigation & Booking Logic ---
            nextToStep2Btn.addEventListener('click', () => {
                if (!selectedDate || doctorSelect.value === "") {
                    alert('Mohon lengkapi Tanggal Kunjungan dan Dokter terlebih dahulu.');
                    return;
                }
                step1.classList.add('hidden');
                step2.classList.remove('hidden');
                renderTimeSlots(); // Render time slots when moving to step 2
            });

            prevToStep1Btn.addEventListener('click', () => {
                step2.classList.add('hidden');
                step1.classList.remove('hidden');
            });

            confirmBookingBtn.addEventListener('click', () => {
                const patientName = patientNameInput.value.trim();
                const phoneNumber = phoneNumberInput.value.trim();
                const doctorName = doctorSelect.value;

                if (!selectedTime || !patientName || !phoneNumber) {
                    alert('Mohon lengkapi semua data: Waktu, Nama, dan Nomor Telepon.');
                    return;
                }

                // --- Simulasi Proses Booking & Nomor Antrean ---
                // Di tahap prototipe ini, kita akan generate nomor antrean secara acak atau sederhana.
                // Di backend (Laravel), ini akan lebih terstruktur.
                const generateQueueNumber = () => {
                    const prefix = 'K'; // Klinik Kandungan
                    const randomNum = Math.floor(100 + Math.random() * 900); // 3 digit random
                    return `${prefix}${randomNum}`;
                };
                const queueNumber = generateQueueNumber();

                // Tampilkan data di Step 3
                displayPatientName.textContent = patientName;
                displayDate.textContent = new Date(selectedDate).toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
                displayTime.textContent = selectedTime;
                displayDoctor.textContent = doctorName;
                displayQueueNumber.textContent = queueNumber;

                step2.classList.add('hidden');
                step3.classList.remove('hidden');
            });

            newBookingBtn.addEventListener('click', () => {
                // Reset semua state dan kembali ke Step 1
                selectedDate = null;
                selectedTime = null;
                selectedDateInput.value = '';
                selectedTimeInput.value = '';
                patientNameInput.value = '';
                phoneNumberInput.value = '';
                doctorSelect.value = '';
                
                // Remove active classes from previously selected items
                document.querySelectorAll('.calendar-day.active').forEach(d => {
                    d.classList.remove('active', 'bg-blue-600', 'text-white');
                });
                document.querySelectorAll('.time-slot.active').forEach(s => {
                    s.classList.remove('active', 'bg-blue-600', 'text-white');
                });

                // Reset calendar to current month/year
                currentMonth = new Date().getMonth();
                currentYear = new Date().getFullYear();
                renderCalendar(currentMonth, currentYear); 

                step3.classList.add('hidden');
                step1.classList.remove('hidden');
            });
        });
    </script>
</body>
</html>
